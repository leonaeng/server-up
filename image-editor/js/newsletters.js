window.newsletters=function(){return{emailStore:window.EmailStore,hasError:!1,isLoading:!1,isSuccess:!1,trackingSource:"",selectedNewsletters:[],email:"",errorMessage:"",uniqueId:0,subscribeEndPoint:"/user/subscribe",newsletters:[],setDefaultSelected(){if("/newsletter_manage"!==window.location.pathname)return;let e=window.location.search.split("listIds=");if(e[1]){let s=e[1].split("&")[0].split(",");for(let e=0;e<s.length;e++){let t=parseInt(s[e],10)||0;this.newsletters.some((e=>e.list_id===t))&&!this.listIsSelected(t)&&this.toggleSelected(t)}}},toggleSelected(e){let s=this.searchInList(this.newsletters,e),t=this.searchInList(this.selectedNewsletters,e);t>-1?this.selectedNewsletters.splice(t,1):this.selectedNewsletters.push(this.newsletters[s])},listIsSelected(e){return this.searchInList(this.selectedNewsletters,e)>-1},searchInList(e,s){let t=-1;return e.forEach(((e,i)=>{e.list_id!=s||(t=i)})),t},submitForm(){this.subscribeEmail()},titlesSelected(){let e=[];return this.newsletters.forEach((s=>{this.listIsSelected(s.list_id)&&e.push(s.title)})),e.join()},subscribeEmail(){if(!this.validSubmission()||this.isLoading)return;let e=this;this.isLoading=!0,this.hasError=!1;let s=[];this.selectedNewsletters.forEach((e=>{s.push(e.courier_list)})),fetch(this.subscribeEndPoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.email,source:this.trackingSource,listIds:this.listIds().join(),courierLists:s.join()})}).then((e=>e.json())).then((function(s){e.isLoading=!1,s&&s.some((e=>!0===e.isSuccess))?(e.subscribeSuccess(),e.addTrackingPixels(s.data)):(e.hasError=!0,e.errorMessage="Something went wrong. Please try again.",e.resetFocus())})).catch((function(s){e.isLoading=!1,e.hasError=!0,e.errorMessage="Something went wrong. Please try again.",e.resetFocus()}))},resetFocus(){this.$refs.newsletterInput.focus()},subscribeSuccess(){this.isSuccess=!0;var e=new CustomEvent("form-onSuccess",{detail:{value:this.isSuccess}});window.dispatchEvent(e),EmailStore.subscribeUser(),this.suppressRententionScript()},suppressRententionScript(){"undefined"!==geq&&null!=geq||function(){var e=window.geq=window.geq||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("GE snippet included twice.");else{e.invoked=!0,e.methods=["page","suppress","trackOrder","identify","addToCart","callBack","event"],e.factory=function(s){return function(){var t=Array.prototype.slice.call(arguments);return t.unshift(s),e.push(t),e}};for(var s=0;s<e.methods.length;s++){var t=e.methods[s];e[t]=e.factory(t)}e.load=function(e){var s=document.createElement("script");s.type="text/javascript",s.async=!0,location.href.includes("vge=true")?s.src="https://s3-us-west-2.amazonaws.com/jsstore/a/"+e+"/ge.js?v="+Math.random():s.src="https://s3-us-west-2.amazonaws.com/jsstore/a/"+e+"/ge.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(s,t)},e.SNIPPET_VERSION="1.6.1",e.load("K97H2Y2")}}(),geq.suppress()},addTrackingPixels(e){for(let s=0;s<e.length;s++)if(e[s].isSuccess){let t=document.createElement("img");t.src=`https://zdbb.net/l/KRlw-jBMEeOsSCIACh-JyA?email_address=${this.email}&mailing=${e[s].id}`,document.querySelector("body").append(t)}},validSubmission(){return""===this.email?(this.errorMessage="Invalid email. Please resubmit.",this.hasError=!0,this.resetFocus(),!1):0!==this.listIds().length||"/newsletter_manage"!==window.location.pathname||(this.errorMessage="Please select a subscription list.",this.hasError=!0,this.resetFocus(),!1)},getTrackingSource(){this.trackingSource=this.$refs.emailForm?this.$refs.emailForm.getAttribute("tracking-source"):""},showEmailSignUp(){return!this.emailStore.state.userIsInEu},showEmailForm(){return!this.emailStore.state.userIsInEu},inputClasses(){return{"border-red-base":this.hasError,"border-gray-lighter":!this.hasError,"rounded-l":this.showSubmitButton,"rounded border-r":!this.showSubmitButton}},listIds(){let e=[];return this.selectedNewsletters.forEach((s=>{e.push(s.list_id)})),e},init(){EmailStore.checkIsUserEu(),EmailStore.checkIsSubscribed(),this.showEmailSignUp(),this.showEmailForm(),this.inputClasses(),this.getTrackingSource();var e=this;this.$watch("isLoading",(function(e){var s=new CustomEvent("form-isLoading",{detail:{value:e}});window.dispatchEvent(s)})),this.$watch("hasError",(function(e){var s=new CustomEvent("form-hasError",{detail:{value:e}});window.dispatchEvent(s)})),this.$watch("email",(function(){e.hasError=!1}))},initNewsletter(e){this.newsletters=[e],this.selectedNewsletters.push(e)},initNewsletters(e){this.newsletters=e,this.setDefaultSelected()}}};