document.body.addEventListener("click",(function(e){var t=e.target.hasAttribute("x-bibblio-track-click")?e.target:e.target.parentElement&&e.target.parentElement.hasAttribute("x-bibblio-track-click")?e.target.parentElement:e.target.parentElement.parentElement&&e.target.parentElement.parentElement.hasAttribute("x-bibblio-track-click")?e.target.parentElement.parentElement:null;t&&(e.preventDefault(),t.dataset.title?t.dataset.title:t.textContent?t.textContent.replace(/(<([^>]+)>)/gi,""):t.value.replace(/(<([^>]+)>)/gi,""),window.sendTracking(t))})),window.attachBibblioViewer=function(){window.bibblioViewed=!1;var e=document.querySelector("[x-bibblio-in-view]");window.onIntersection=function(e){!window.bibblioViewed&&e[0].isIntersecting&&(window.bibblioViewed=!0,window.sendTracking())},e&&(window.bibblioObserver=new window.IntersectionObserver(window.onIntersection,{rootMargin:"0px"}),window.bibblioObserver.observe(e))},window.sendTracking=function(e=null){var t=e||document.querySelector("[x-bibblio-track-click]");if(t){var n=document.querySelectorAll("[x-bibblio-context]"),i=[["sourceHref",window.location.href],["sourceCustomUniqueIdentifier",t.dataset.sourceUrl]];n.forEach((function(e){i.push(["recommendations.customUniqueIdentifier",e.dataset.bibblioId])}));var o=new XMLHttpRequest;o.open("POST",t.dataset.context),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Authorization","Bearer "+window.bibblioRecommendationKey),o.onreadystatechange=function(){4===this.readyState&&(console.log("Status:",this.status),console.log("Headers:",this.getAllResponseHeaders()),console.log("Body:",this.responseText))};var r={type:e?"Clicked":"Viewed",context:i};e&&(r.object=[["customUniqueIdentifier",e.dataset.bibblioId]]),o.onload=function(){e&&(window.location=e.getAttribute("href"))},o.onerror=function(){e&&(window.location=e.getAttribute("href"))},o.send(JSON.stringify(r))}};